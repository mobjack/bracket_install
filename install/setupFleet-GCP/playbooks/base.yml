---
#
# This file contains the standard configs across all 
# systems that are managed.
#

- hosts: all

  tasks:
  # Install standard packages here
  - name: "Installing standard packages?"
    apt: 
      pkg: 
        - build-essential
        - net-tools 
        - vim
        - netcat
        - git
        - tcpdump
        - wget
        - curl
        - docker
    become: true

  # Check the alt python3 version
  - name: check alt python version
    shell: /usr/local/bin/python3.7 --version
    register: python3_version
    ignore_errors: yes  # If not installed
    tags:
      - python-alt

  - name: Create a python install directory if it does not exist
    file:
      path: /tmp/python37.src
      state: directory
      mode: '0755'
    when: python3_version.stderr != "" 
    tags:
      - python-alt

  - name: Download and unpack alternative python3
    unarchive:
      src: https://www.python.org/ftp/python/3.7.3/Python-3.7.3.tgz
      dest: /tmp/python37.src
      remote_src: yes
      keep_newer: yes
    when: python3_version.stderr != "" 
    tags:
      - python-alt

  - name: make install alt python3
    make:
      chdir: /tmp/python37.src/Python-3.7.3
      target: altinstall
      params:
        UNINST: 1  # Replace
    when: python3_version.stderr != "" 
    become: true
    tags:
      - python-alt
    
  - name: Download get-pip.py
    get_url:
      url: https://bootstrap.pypa.io/get-pip.py
      dest: /tmp/get-pip.py
      mode: 0664
    tags:
      - python-alt
    
  - name: Install pip for python3
    shell: /usr/local/bin/python3.7 /tmp/get-pip.py
    become: yes
    tags:
      - python-alt
    
    # We need virtualenv installed under py3 for the virtualenv command to work
  - pip:
      name: virtualenv
      executable: /usr/local/bin/pip3.7
    become: True
    tags:
      - python-alt